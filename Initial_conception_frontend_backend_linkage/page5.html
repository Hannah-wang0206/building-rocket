<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page 5</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-image: url('assets/images/Page5/01.png'); /* 背景图 */
            background-size: cover;
            background-position: center;
            height: 100vh;
            position: relative;
        }

        /* 右侧的图片容器 */
        .image-container {
            position: absolute;
            top: 50%;
            right: 0;
            left: 50%;
            transform: translateY(-50%);
            width: 620px;
            height: 470px;
            background-image: url('assets/images/Page5/02.png');
            background-size: cover;
            background-position: center;
            position: relative;
        }

        /* 右上角按钮 */
        .top-right-button {
            position: absolute;
            top: -5%;
            right: 5%;
            left: 74%;
            width: 160px;
            height: 23px;
            background-image: url('assets/images/Page5/03.png');
            background-size: cover;
            border: none;
            cursor: pointer;
            transition: background-image 0.3s ease;
        }

        .top-right-button:hover {
            background-image: url('assets/images/Page5/04.png');
        }

        .top-right-button:hover:after {
            content: '';
            background-image: url('assets/images/Page5/05.png');
            position: absolute;
            top: 20px;
            right: -5px;
            width: 555px;
            height: 500px;
            background-size: cover;
        }

        /* 底部右侧按钮 */
        .bottom-right-button {
            position: absolute;
            bottom: 5%;
            right: 5%;
            width: 84px;
            height: 25px;
            background-image: url('assets/images/Page5/06.png');
            background-size: cover;
            border: none;
            cursor: pointer;
            transition: background-image 0.3s ease;
        }

        .bottom-right-button:hover {
            background-image: url('assets/images/Page5/07.png');
        }

        /* 用户输入区域 */
        .input-container {
            position: absolute;
            bottom: 10%;
            left: 4.5%; /* 向左偏移1个单位 */
            color: white;
        }

        /* 小标题 */
        .subheading {
            font-size: 24px;
            margin-bottom: 10px;
            opacity: 0.85; /* 标题透明度调整为85% */
        }

        /* 选项区域 */
        .options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-box {
            background-color: transparent;
            border: 2px solid white;
            color: white;
            padding: 5px 15px;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .input-box:hover, .input-box.selected {
            background-color: white;
            color: black;
        }

        /* 滑块及数值容器 */
        .slider-container {
            display: flex; /* 使用 flex 布局 */
            align-items: center; /* 垂直方向居中对齐 */
            justify-content: space-between; /* 滑块和文字两侧对齐 */
            margin-bottom: 20px; /* 底部间距 */
        }

        /* 滑块标签文字 */
        .slider-label {
            font-size: 16px;
            margin-right: 20px; /* 滑块和文字之间的间距 */
            white-space: nowrap; /* 防止文字换行 */
        }

        /* 滑块 */
        .slider {
            flex: 1; /* 滑块填充剩余空间 */
            margin: 0 10px; /* 滑块两侧间距 */
            height: 5px; /* 滑块轨道高度 */
            background: white; /* 滑块轨道颜色 */
            border-radius: 5px; /* 圆角效果 */
            outline: none; /* 移除默认边框 */
            appearance: none; /* 标准属性 */
            -webkit-appearance: none; /* 针对 WebKit 的禁用默认样式 */
        }

        /* 滑块的拇指样式（默认外观） */
        .slider::-webkit-slider-thumb {
            -webkit-appearance: slider-vertical; /* 使用默认滑块样式 */
            appearance: slider-vertical; /* 标准属性，使用默认样式 */
            width: 20px; /* 滑块宽度 */
            height: 20px; /* 滑块高度 */
            cursor: pointer; /* 鼠标样式为指针 */
        }

        /* 针对 Firefox 的滑块拇指样式 */
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* 滑块两端的数值 */
        .slider-value {
            font-size: 16px;
            margin-left: 20px; /* 数值和滑块之间的间距 */
            white-space: nowrap; /* 防止文字换行 */
        }

        /* 输入框装饰 */
        .underline {
            background-image: url('assets/images/Page5/09.png');
            background-repeat: no-repeat;
            background-position: left;
            background-size: 100% 2px;
            border: none;
            font-size: 24px;
            width: 300px;
            padding-left: 20px;
            color: #00008B; /* 深蓝色 (DarkBlue) */
            opacity: 0.7; /* 输入框透明度调整为70% */
        }

        .underline::placeholder {
            color: rgba(0, 0, 139, 0.4); /* 深蓝色 (DarkBlue) 提示文字，透明度 30% */
        }

        .underline:focus {
            opacity: 1; /* 聚焦时确保输入文字清晰 */
            outline: none; /* 移除聚焦边框 */
        }
    </style>
</head>
<body>

    <!-- 右侧图片容器 -->
    <div class="image-container">
        <!-- 右上角按钮 -->
        <button class="top-right-button"></button>
    </div>

    <!-- 底部右侧按钮 -->
    <button class="bottom-right-button" onclick="goToNextPage()"></button>

    <!-- 用户输入区域 -->
    <div class="input-container">
        <!-- 选择目的地 -->
        <div class="subheading">Select your destination</div>
        <div class="options">
            <button class="input-box" onclick="selectOption(this)">Moon</button>
            <button class="input-box" onclick="selectOption(this)">Venus</button>
            <button class="input-box" onclick="selectOption(this)">Mars</button>
        </div>

        <!-- 输入参数 -->
        <div class="subheading">Input Your Parameters</div>
        <div class="slider-container">
            <div class="slider-label">
                <span>Launch angle (degrees)</span>
                <span id="angle-value">45</span>
            </div>
            <input id="launch-angle" class="slider" type="range" min="10" max="80" value="45" oninput="updateSliderValue('angle-value', this.value)">
        </div>
        <div class="slider-container">
            <div class="slider-label">
                <span>Launch velocity (m/s)</span>
                <span id="velocity-value">15000</span>
            </div>
            <input id="launch-velocity" class="slider" type="range" min="5000" max="30000" value="15000" oninput="updateSliderValue('velocity-value', this.value)">
        </div>
        <div class="slider-container">
            <div class="slider-label">
                <span>Fuel reserve</span>
                <span id="fuel-value">600</span>
            </div>
            <input id="fuel-reserve" class="slider" type="range" min="200" max="1000" value="600" oninput="updateSliderValue('fuel-value', this.value)">
        </div>

        <!-- 项目名称 -->
        <div class="subheading">Name your project</div>
        <input id="project-name" class="underline" type="text" placeholder="Type here">

        <!-- 启动日期 -->
        <div class="subheading">Enter your launch date</div>
        <input id="launch-date" class="underline" type="date">
    </div>

    <script>
        // 记录用户选择的星球和参数
        let userInputs = {
            destination: null,
            launchAngle: 45,
            launchSpeed: 15000,
            fuelAmount: 600,
            projectName: '',
            launchDate: ''
        };

        // 选中选项时更新目标星球
        function selectOption(button) {
            document.querySelectorAll('.input-box').forEach(item => item.classList.remove('selected'));
            button.classList.add('selected');
            userInputs.destination = button.textContent;
            updateTrajectory();
        }

        // 更新滑块的数值并触发轨道更新
        function updateSliderValue(elementId, value) {
            document.getElementById(elementId).textContent = value;
            if (elementId === 'angle-value') userInputs.launchAngle = parseFloat(value);
            if (elementId === 'velocity-value') userInputs.launchSpeed = parseFloat(value);
            if (elementId === 'fuel-value') userInputs.fuelAmount = parseFloat(value);
            updateTrajectory();
        }

        // 更新轨道可视化
        async function updateTrajectory() {
            if (!userInputs.destination) return; // 未选择目标星球时不更新轨道
            try {
                const response = await fetch('/generate_orbit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        target: userInputs.destination,
                        angle: userInputs.launchAngle,
                        velocity: userInputs.launchSpeed,
                        fuel: userInputs.fuelAmount
                    })
                });
                const data = await response.json();
                if (data.success && data.plot_url) {
                    // 删除旧的轨道图片
                    const imageContainer = document.querySelector('.image-container');
                    let oldImage = imageContainer.querySelector('img');
                    if (oldImage) oldImage.remove();

                    // 添加新图片
                    const newImage = document.createElement('img');
                    newImage.src = data.plot_url;
                    newImage.style.width = '100%';
                    newImage.style.height = '100%';
                    newImage.style.position = 'absolute';
                    newImage.style.top = '0';
                    newImage.style.left = '0';
                    imageContainer.appendChild(newImage);
                } else {
                    console.error('Failed to generate trajectory:', data.message);
                }
            } catch (error) {
                console.error('Error updating trajectory:', error);
            }
        }

        // 验证输入并跳转
        function goToNextPage() {
            const { destination, launchAngle, launchSpeed, fuelAmount, projectName, launchDate } = userInputs;
            if (!destination) {
                alert('Please select a destination.');
                return;
            }

            let valid = true;
            let message = '';

            if (destination === 'Moon') {
                if (launchAngle < 10 || launchAngle > 80) valid = false;
                if (launchSpeed < 5000 || launchSpeed > 12000) valid = false;
                if (fuelAmount < 200 || fuelAmount > 900) valid = false;
                message = 'For Moon:\nAngle: 10°-80°\nSpeed: 5000-12000 m/s\nFuel: 200-900 units';
            } else if (destination === 'Venus' || destination === 'Mars') {
                if (launchAngle < 10 || launchAngle > 80) valid = false;
                if (launchSpeed < 10000 || launchSpeed > 30000) valid = false;
                if (fuelAmount < 300 || fuelAmount > 1000) valid = false;
                message = 'For Venus/Mars:\nAngle: 10°-80°\nSpeed: 10000-30000 m/s\nFuel: 300-1000 units';
            }

            if (!valid) {
                alert(`Invalid inputs! ${message}`);
                return;
            }

            // 存储项目名称和启动日期到 sessionStorage
            userInputs.projectName = document.getElementById('project-name').value;
            userInputs.launchDate = document.getElementById('launch-date').value;
            sessionStorage.setItem('userInputs', JSON.stringify(userInputs));

            window.location.href = `/page6?planet=${encodeURIComponent(destination)}&launch_angle=${encodeURIComponent(launchAngle)}&launch_speed=${encodeURIComponent(launchSpeed)}&fuel_amount=${encodeURIComponent(fuelAmount)}&launch_date=${encodeURIComponent(launchDate)}&project_name=${encodeURIComponent(projectName)}`;
        }
    </script>

</body>
</html>








